
from sentence_transformers import SentenceTransformer
from transformers import AutoTokenizer, AutoModel
import torch

class embed_model:
    @staticmethod
    def sentence_transformer(model_name: str = "all-MiniLM-L6-v2"):
        """
        Load a SentenceTransformer embedding model.
        
        :param model_name: Pretrained model from sentence-transformers
        :return: Embedding function
        """
        model = SentenceTransformer(model_name)

        def embed(texts):
            if isinstance(texts, str):
                texts = [texts]
            return model.encode(texts, convert_to_numpy=True)
        
        return embed

    @staticmethod
    def huggingface_embedding(model_name: str = "bert-base-uncased"):
        """
        Load a HuggingFace embedding model (e.g., BERT, RoBERTa).
        
        :param model_name: HuggingFace model ID
        :return: Embedding function
        """
        tokenizer = AutoTokenizer.from_pretrained(model_name)
        model = AutoModel.from_pretrained(model_name)

        def embed(texts):
            if isinstance(texts, str):
                texts = [texts]

            # Tokenize input
            inputs = tokenizer(texts, padding=True, truncation=True, return_tensors="pt")
            with torch.no_grad():
                outputs = model(**inputs)

            # Use mean pooling of token embeddings
            embeddings = outputs.last_hidden_state.mean(dim=1)
            return embeddings.numpy()
        
        return embed


# ---------------- Example Usage ----------------
if __name__ == "__main__":
    # SentenceTransformer
   # st_embed = embed_model.sentence_transformer()
  #  print("SentenceTransformer:", st_embed("RAG improves LLM factual accuracy."))

    # HuggingFace BERT
    hf_embed = embed_model.huggingface_embedding()
    print("HuggingFace:", hf_embed("RAG retrieves documents for better answers."))


"""
SentenceTransformer: [[ 5.56671992e-03  4.03918810e-02  3.82949635e-02 -7.42182806e-02
  -4.25119437e-02  2.59066690e-02 -4.16227393e-02  2.60067564e-02
  -1.61543842e-02  1.04960483e-02 -1.05479639e-02  2.13958044e-02
   4.86465432e-02 -1.23837581e-02 -1.22863539e-02  6.39427006e-02
   1.15803182e-01  1.67734519e-01 -1.26177231e-02 -5.56683615e-02
  -6.12125620e-02  7.73862051e-03  7.03762621e-02  6.61056489e-03
   3.79208550e-02 -3.13964076e-02 -3.17528262e-03  2.77744737e-02
   8.49246234e-02 -5.74898608e-02  8.59866571e-03  1.24129780e-01
  -7.29445443e-02 -3.53426486e-02 -7.03904927e-02  1.14448285e-02
  -1.39581244e-02  1.01463638e-01 -1.18890107e-02 -1.26410797e-02
   5.81607744e-02 -4.42908071e-02  3.93150672e-02 -4.75964211e-02
   8.46592057e-03  9.92260501e-02 -2.69002351e-03  7.55708590e-02
  -8.30702856e-02  9.50050540e-03 -2.95078605e-02  3.02715264e-02
   3.96464672e-03 -3.54445726e-02 -7.82829821e-02 -8.03260691e-03
   7.21985251e-02  9.24395677e-03 -1.40051376e-02 -1.41542638e-02
  -1.72373746e-02 -4.21457998e-02 -9.15797353e-02  4.23081219e-03
   1.17255077e-01 -3.17198113e-02  8.03341940e-02  4.38267291e-02
  -4.87285815e-02  6.64771646e-02  1.00525934e-02 -8.72235559e-03
  -1.27114132e-02  1.40548781e-01 -4.29854952e-02  2.56223534e-03
  -6.20521978e-03  6.11857651e-03  9.92687941e-02  1.28567722e-02
  -4.69090492e-02  1.78107265e-02 -3.10483836e-02  3.59721258e-02
   4.23743129e-02 -1.27482666e-02 -2.35924274e-02 -5.16561083e-02
  -5.29015921e-02 -1.48209399e-02  7.50004798e-02 -8.41724351e-02
  -8.71415075e-04  4.03455272e-02  8.79364386e-02  3.96713167e-02
   2.24860050e-02  7.25629777e-02 -4.78078192e-03  3.15356888e-02
  -3.75767215e-03  4.10444997e-02 -5.32313474e-02 -2.07354426e-02
   1.57874618e-02 -8.38430151e-02  6.00275956e-03 -1.57193486e-02
   5.90192154e-03 -3.66866253e-02  1.06881104e-01  2.03335490e-02
   7.13847065e-03 -7.83928554e-04 -6.33539725e-03  1.30698523e-02
   1.66639928e-02  1.26714865e-03 -2.42656115e-02 -1.98666528e-02
  -4.26006392e-02  3.11116576e-02 -3.70206125e-02  9.50459093e-02
   2.93913018e-02 -5.85400946e-02  3.57813239e-02 -2.00023551e-33
   2.26882212e-02  1.18599636e-02 -2.44315546e-02  4.53327075e-02
  -3.06734648e-02  2.22882908e-02 -3.59310471e-02 -5.41540533e-02
   7.53576532e-02  3.24497521e-02 -3.55965085e-02  1.83396190e-02
   1.16961841e-02 -2.98798941e-02  1.39504354e-02  6.55046105e-02
  -5.67866787e-02 -2.40278356e-02 -5.54548688e-02 -1.77131724e-02
   5.62363863e-03  6.47768006e-02  4.65529375e-02 -9.09084231e-02
  -8.52772817e-02  1.13663547e-01  1.03371605e-01  3.72123830e-02
  -7.21502006e-02  1.80024691e-02 -3.74069298e-03 -4.07802761e-02
   5.04075899e-04  2.71194447e-02  4.57941331e-02 -1.57437176e-02
  -1.16906002e-01 -2.32234038e-02 -3.09757777e-02 -5.75659145e-03
  -7.31048640e-03  3.16736959e-02 -2.22958867e-02 -2.32081041e-02
   1.89449210e-02 -1.72001943e-02  9.71620157e-03  2.57316069e-03
   2.06553359e-02  7.54524693e-02  1.22230001e-01  5.44914603e-02
  -7.04312027e-02  1.32349245e-02 -1.82924848e-02  5.57140782e-02
  -8.84036301e-04 -1.43751642e-02 -1.37550279e-03  5.35368584e-02
  -1.59696955e-02  4.29925844e-02  2.19396781e-02  6.63688853e-02
   1.75724439e-02  4.80105020e-02 -5.74515797e-02 -3.91856709e-04
   3.37833017e-02 -4.79380600e-02  4.32320079e-03 -3.40032913e-02
  -4.83390409e-03  5.41957803e-02 -1.00198239e-02 -7.37864822e-02
   8.41235146e-02  1.73161570e-02  2.06452142e-02 -4.53404039e-02
   1.34981662e-01  3.37360017e-02 -4.53563593e-02 -6.72539696e-02
  -6.81808144e-02 -5.64773194e-02  2.75123827e-02 -8.02795216e-02
  -3.98104601e-02  7.28319818e-03  3.57962772e-02 -4.06250022e-02
  -1.57677243e-03  7.88514763e-02 -1.03126742e-01  1.78180497e-33
  -4.99521494e-02 -2.63070893e-02  3.06918416e-02  1.72676519e-01
  -5.34372032e-02 -3.02939154e-02 -3.63675435e-03  4.21610810e-02
  -3.86809856e-02  4.86806445e-02  3.45015712e-02  4.43271315e-03
  -7.13008642e-02  1.77215990e-02  5.13695776e-02  8.74326658e-03
   3.41760367e-03 -7.08866026e-03 -4.92916554e-02  5.75757660e-02
   7.14441240e-02  5.51869832e-02  1.68709699e-02  5.23045175e-02
  -3.85259688e-02  2.98624504e-02  6.46138191e-02 -4.49319147e-02
  -3.96091901e-02  2.78226566e-03  7.25868419e-02 -5.32300137e-02
  -5.88703603e-02 -1.91655196e-02 -3.42474431e-02 -4.37440313e-02
   1.07490689e-01  1.05745517e-01 -3.75704132e-02 -4.03166935e-02
   3.68426368e-02 -2.01403201e-02 -6.76758364e-02  1.05460100e-02
  -4.86473888e-02 -1.93325598e-02 -7.44281858e-02 -1.27221271e-02
   4.98716012e-02  8.51975009e-03  4.09626029e-02 -4.91098315e-02
   6.47315159e-02 -1.96385421e-02  1.19681181e-02 -3.08992416e-02
  -1.99304633e-02 -8.66112784e-02 -6.75090179e-02  7.54526407e-02
  -3.15724649e-02  5.56603596e-02 -4.06593382e-02 -5.17935827e-02
   6.54060319e-02  4.66603823e-02 -8.00220966e-02 -8.95362534e-03
  -8.14639628e-02  2.29193247e-03 -3.27201386e-04 -2.24353671e-02
  -4.05216739e-02 -1.20564461e-01  1.76424924e-02  2.40267515e-02
   1.66238230e-02 -5.78802861e-02 -2.71885041e-02 -2.81109158e-02
  -3.92235145e-02 -1.15787692e-01  3.29195103e-03  6.54164627e-02
  -3.71737368e-02  1.17656793e-02 -4.80371863e-02 -5.95270582e-02
   3.17226648e-02  4.58337478e-02  4.43531200e-02  3.13895456e-02
  -4.82005253e-02 -5.90804107e-02 -5.66978985e-03 -1.41411052e-08
   1.16592199e-02 -6.58077598e-02 -1.89859997e-02  7.12741166e-02
  -6.51688501e-02 -8.40974040e-03 -1.17007896e-01  4.74994406e-02
  -1.76968556e-02  6.93745613e-02  1.01297230e-01  1.24273105e-02
  -1.05499253e-01 -5.24530327e-03  7.04685897e-02 -3.95271331e-02
  -1.59654375e-02 -9.61134862e-03 -9.10546109e-02 -2.48666797e-02
   1.49485255e-02  6.00150041e-02  6.96914420e-02 -2.02971455e-02
   4.58234064e-02  1.79152358e-02 -4.42179665e-02  1.51152477e-01
   4.82514277e-02  3.31709012e-02  3.99611332e-02 -2.07182346e-03
  -1.72412787e-02 -2.61628516e-02 -1.32647436e-02  9.99800209e-03
   5.09172380e-02  3.67777348e-02  6.67530522e-02  7.21234130e-04
  -4.34357971e-02  3.61693762e-02 -1.53471315e-02  7.85011351e-02
   5.27552189e-03 -5.89393266e-02 -7.28674307e-02 -7.56017193e-02
  -5.16760834e-02 -3.56695913e-02  1.95596740e-02  4.50218357e-02
   5.43940533e-03  2.32579727e-02  3.15118057e-04  1.73024796e-02
  -1.98300667e-02 -6.97523355e-02 -4.42827754e-02  4.10632566e-02
   6.52050972e-02 -2.56218687e-02 -3.99989039e-02 -4.98762634e-03]]
"""
"""
"""